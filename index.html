<!DOCTYPE html>
<html lang="en">
  <head>
    <meta charset="UTF-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />

    <link
      rel="icon"
      href="resources/images/favicon.ico"
      type="image/x-icon"
      sizes="96x96"
    />

    <link rel="stylesheet" href="styles.css">

    <title>Device Shop Checkout | devChallenges.io</title>
  </head>
  <body>
    <!--
    Checkout

    3 items

    iPhone 12 Pro

    Golden

    $999.00

    x 1

    Apple Watch

    Blue

    $399.00

    iMac

    Green

    $1199.00

    Enter coupon code

    Apply Coupon

    Sub total

    $2597.00

    Tax

    $623.28

    Total

    $3220.28

    Contact Information

    First & Last name

    Enter first & last name

    Email Address

    Enter email address

    Country

    Finland

    Postal Code

    00270

    Continue
     -->
  <main>
    <div class="top-section">
      <div class="text">
        <h1>Checkout</h1>
        <p>3 ITEMS</p>
      </div>
    </div>
    <div class="container mx-auto">
      <section class="cart px-6 py-8">
          <ul class="cart-items flex flex-col">
            <li class="cart-item" role="listitem" data-product-id="1">
              <div class="item-image flex justify-center items-center">
                <img src="resources/images/Gold@2x.png" alt="iPhone 12 Pro" />
              </div>
              <div class="item-info-quantity flex flex-col justify-between">
                <div class="item-info">
                    <h4 class="item-name font-bold">iPhone 12 Pro</h4>
                    <p class="item-color font-semibold">Golden</p>
                  </div>
                <div class="quantity">
                    <p>x 1</p>
                </div>
              </div>
              <div class="item-price-remove flex flex-col justify-between">
                  <p class="item-price font-bold">
                    $999.00
                  </p>
                <button class="remove" aria-label="Remove iPhone 12 Pro from cart" data-productId="1">
                  X
                </button>
              </div>
            </li>
            <li class="cart-item" role="listitem" data-product-id="2">
                <div class="item-image flex justify-center items-center">
                  <img src="/resources/images/Apple-watchx2.png"/>
                </div>
                <div class="item-info-quantity flex flex-col justify-between">
                  <div class="item-info">
                      <h4 class="item-name font-bold">Apple Watch</h4>
                      <p class="item-color font-semibold">Blue</p>
                    </div>
                    <div class="quantity">
                        <p>x 1</p>
                    </div>
                </div>
                <div class="item-price
                -remove flex flex-col justify-between">
                    <p class="item-price font-bold">
                      $399.00
                    </p>
                    <button class="remove" aria-label="Remove Apple Watch from cart" data-productId="2">
                        X
                    </button>
                </div>
            </li>
            <li class="cart-item" role="listitem" data-product-id="3">
                <div class="item-image flex justify-center items-center">
                  <img src="/resources/images/iMac@2x.png"/>
                </div>
                <div class="item-info-quantity flex flex-col justify-between">
                  <div class="item-info">
                      <h4 class="item-name font-bold">iMac</h4>
                      <p class="item-color font-semibold">Green</p>
                    </div>
                    <div class="quantity">
                        <p>x 1</p>
                    </div>
                </div>
                <div class="item-price remove flex flex-col justify-between">
                    <p class="item-price font-bold">
                      $1199.00
                    </p>
                    <button class="remove" aria-label="Remove iMac from cart" data-productId="3">
                        X
                    </button>
                </div>
            </li>
          </ul>
          <div class="coupon flex justify-between">
                <label class="sr-only" for="coupon-code">Enter coupon code</label>
              <input class="font-semibold" id="coupon-code" type="text" placeholder="Enter coupon code" />
              <button class="font-bold">Apply Coupon</button>
          </div>
          <div class="total">
              <div class="subtotal flex justify-between font-bold">
                <p>Sub total</p>
                <p>$2597.00</p>
              </div>
              <div class="tax flex justify-between font-bold">
                <p>Tax</p>
                <p>$623.28</p>
              </div>
              <div class="total-amount flex justify-between font-bold">
                <p>Total</p>
                <p>$3220.28</p>
              </div>
          </div>
      </section>
      <section class="contact-info px-6 py-6">
        <form aria-labelledby="contact-info">
          <fieldset>
            <legend id="form-title">
                <h2>Contact Information</h2>
            </legend>
            <div class="form-groups">
              <div class="form-group flex flex-col">
                <label class="font-semibold" for="name">First & Last Name</label>
                <input
                        type="text"
                        id="name"
                        name="name"
                        placeholder="Enter first & last name"
                        required
                        aria-required="true"
                />
              </div>
              <div class="form-group flex flex-col">
                <label class="font-semibold" for="email">Email Address</label>
                <input
                        type="email"
                        id="email"
                        name="email"
                        placeholder="Enter email address"
                        required
                        aria-required="true"
                />
              </div>
              <div class="country-zip flex justify-between w-full">
                <div class="country-wrapper form-group flex flex-col">
                  <label class="font-semibold" for="country">Country</label>
                  <select id="country" name="country" aria-label="Select your country">
                    <option value="Finland">Finland</option>
                    <option value="USA">USA</option>
                    <option value="UK">UK</option>
                    <option value="Germany">Germany</option>
                    <option value="France">France</option>
                  </select>
                </div>
                <div class="zip-wrapper form-group flex flex-col">
                  <label class="font-semibold" for="postal">Postal Code</label>
                  <input
                          type="text"
                          id="postal"
                          name="postal"
                          placeholder="00270"
                          pattern="\d{5}"
                          aria-describedby="postal-hint"
                          required
                          aria-required="true"
                  />
                </div>
              </div>
            </div>
            <button class="font-bold w-full" type="submit" aria-label="Submit the form">Continue</button>
          </fieldset>
        </form>
      </section>
    </div>
  </main>
  <script>

    function getPrice(price){
      // Remove $ sign, white spaces and convert to number
      return parseFloat(price.replace('$', ''));
    }

    function getQuantity(quantity){
      // Remove X sign, white spaces and convert to number
      return parseInt(quantity.replace('x', ''));
    }

    function getItemsInCart(){
      const cartItems = document.querySelectorAll('.cart-item');
      const items = [];
      cartItems.forEach((item) => {
        const productId = item.getAttribute('data-product-id');
        const name = item.querySelector('.item-name').textContent;
        const color = item.querySelector('.item-color').textContent;
        const price = getPrice(item.querySelector('.item-price').textContent);
        const quantity = getQuantity(item.querySelector('.quantity').textContent);
        items.push({
          productId,
          name,
          color,
          price,
          quantity
        });
      });
      return items;
    }

    const removeButtons = document.querySelectorAll('.remove');
    removeButtons.forEach((button) => {
      button.addEventListener('click', (e) => {
        const productId = e.target.getAttribute('data-productId');
        const product = document.querySelector(`[data-product-id="${productId}"]`);
        product.remove();
      });
    });

    const form = document.querySelector('form');

    form.addEventListener('submit', (e) => {
      e.preventDefault();
      const formData = new FormData(form);
      const userData = Object.fromEntries(formData.entries());

      const items = getItemsInCart();

      const order = {
        userData,
        items
      };

      console.log(order);

      // Reset form
      form.reset();
      
    });

    // Apply coupon
    const applyCoupon = document.querySelector('.coupon button');

    applyCoupon.addEventListener('click', () => {
      const couponCodeInput = document.querySelector('#coupon-code');
      const couponCode = couponCodeInput.value;
      console.log(couponCode);
      couponCodeInput.value = '';
    });
  </script>
  </body>
</html>
